#+PROPERTY: header-args :comments yes :results silent
#+STARTUPd: overview
* My Emacs Configuration
** About
It's built using [[http://orgmode.org][Org mode]]'s [[http://orgmode.org/manual/Extracting-source-code.html#Extracting-source-code][tangling functionality]].

My entire Emacs configuration is thus written in a [[https://en.wikipedia.org/wiki/Literate_programming][literate programming]] style,
and is contained entirely in this file.

*** Requirements
- [[https://git-scm.com/]]
- npm
- python
- [[https://github.com/ggreer/the_silver_searcher]]
- https://pypi.org/project/pip/
- [[https://virtualenv.pypa.io/en/latest/]]
- https://github.com/mermaid-js/mermaid-cli

Any external/third party works included in this work are licensed under
their own licenses - refer to the submodules or packages for more
information

** AboutConfigure Elpaca
#+BEGIN_SRC emacs-lisp
  (defvar elpaca-installer-version 0.11)
  (defvar elpaca-directory (expand-file-name "elpaca/" user-emacs-directory))
  (defvar elpaca-builds-directory (expand-file-name "builds/" elpaca-directory))
  (defvar elpaca-repos-directory (expand-file-name "repos/" elpaca-directory))
  (defvar elpaca-order '(elpaca :repo "https://github.com/progfolio/elpaca.git"
                                :ref nil :depth 1
                                :files (:defaults "elpaca-test.el" (:exclude "extensions"))
                                :build (:not elpaca--activate-package)))
  (let* ((repo  (expand-file-name "elpaca/" elpaca-repos-directory))
         (build (expand-file-name "elpaca/" elpaca-builds-directory))
         (order (cdr elpaca-order))
         (default-directory repo))
    (add-to-list 'load-path (if (file-exists-p build) build repo))
    (unless (file-exists-p repo)
      (make-directory repo t)
      (when (< emacs-major-version 28) (require 'subr-x))
      (condition-case-unless-debug err
          (if-let ((buffer (pop-to-buffer-same-window "*elpaca-bootstrap*"))
                   ((zerop (apply #'call-process `("git" nil ,buffer t "clone"
                                                   ,@(when-let ((depth (plist-get order :depth)))
                                                       (list (format "--depth=%d" depth) "--no-single-branch"))
                                                   ,(plist-get order :repo) ,repo))))
                   ((zerop (call-process "git" nil buffer t "checkout"
                                         (or (plist-get order :ref) "--"))))
                   (emacs (concat invocation-directory invocation-name))
                   ((zerop (call-process emacs nil buffer nil "-Q" "-L" "." "--batch"
                                         "--eval" "(byte-recompile-directory \".\" 0 'force)")))
                   ((require 'elpaca))
                   ((elpaca-generate-autoloads "elpaca" repo)))
              (progn (message "%s" (buffer-string)) (kill-buffer buffer))
            (error "%s" (with-current-buffer buffer (buffer-string))))
        ((error) (warn "%s" err) (delete-directory repo 'recursive))))
    (unless (require 'elpaca-autoloads nil t)
      (require 'elpaca)
      (elpaca-generate-autoloads "elpaca" repo)
      (load "./elpaca-autoloads")))
  (add-hook 'after-init-hook #'elpaca-process-queues)
  (elpaca `(,@elpaca-order))

  (setq package-enable-at-startup nil)


  ;; Install use-package support
  (elpaca elpaca-use-package
    ;; Enable use-package :ensure support for Elpaca.
    (elpaca-use-package-mode))
  (setq use-package-always-ensure t)
         #+END_SRC

* Visual
** Themes
all-the-icons package
- https://github.com/domtronn/all-the-icons.el
Run:
M-x: all-the-icons-install-fonts
#+BEGIN_SRC emacs-lisp
  (use-package all-the-icons :demand t)
#+END_SRC

Doom Theme
- https://github.com/hlissner/emacs-doom-themes
#+BEGIN_SRC emacs-lisp
  (use-package doom-themes :demand t :config (load-theme 'doom-city-lights))
#+END_SRC

Kaolin Theme
#+BEGIN_SRC emacs-lisp
  (use-package kaolin-themes :demand t)
#+END_SRC

Doom modeline
- https://github.com/hlissner/emacs-doom-themes
- Run: M-x: nerd-icons-install-fonts
#+BEGIN_SRC emacs-lisp
  (use-package doom-modeline
    :demand t
    :init (doom-modeline-mode 1)
    :config
  (setq doom-modeline-project-detection 'project)
  (setq doom-modeline-major-mode-color-icon t)
  (setq doom-modeline-buffer-encoding t) ;; Whether display the buffer encoding.
  (setq doom-modeline-lsp t)
  (setq doom-modeline-env-version t)
  (setq doom-modeline-support-imenu t)
  (setq doom-modeline-time-icon t))
#+END_SRC

** visual
Solaire mode
- https://github.com/hlissner/emacs-solaire-mode
#+BEGIN_SRC emacs-lisp
  (use-package solaire-mode
    :demand t
    :init (solaire-global-mode +1))
#+END_SRC

* Basic settings
** General
Copy environment variables into emacs
#+BEGIN_SRC emacs-lisp
  (use-package exec-path-from-shell
    :config (exec-path-from-shell-initialize))
#+END_SRC

To speed up TRAMP access, letâ€™s disabled lock files (#files))
#+BEGIN_SRC emacs-lisp
  (setq remote-file-name-inhibit-locks t)
#+END_SRC

Turn off vc for remote files because it slows down git operatons
#+BEGIN_SRC emacs-lisp
  (defun turn-off-vc-for-remote-files ()
    "Disable version control for remote files.
  Use with the `find-file-hook'."
    (when (file-remote-p (buffer-file-name))
      (setq-local vc-handled-backends nil)))

  (add-hook 'find-file-hook 'turn-off-vc-for-remote-files)
#+END_SRC

Do not show startup message
#+BEGIN_SRC emacs-lisp
  (setq inhibit-startup-message t)
#+END_SRC

Hide toolbar
#+BEGIN_SRC emacs-lisp
  (tool-bar-mode -1)
#+END_SRC

Hide scrollbar
#+BEGIN_SRC emacs-lisp
  (scroll-bar-mode -1)
#+END_SRC

Which-key
#+BEGIN_SRC emacs-lisp
  (use-package which-key
    :demand t
    :init (which-key-mode)
    :diminish which-key-mode
    :config
    (setq which-key-idle-delay 0.3))
#+END_SRC

 ~ and # files
#+BEGIN_SRC emacs-lisp
  ;; (setq make-backup-files nil)
  (setq backup-directory-alist `(("." . ,(concat user-emacs-directory "backups"))))
  (setq create-lockfiles nil)
#+END_SRC

Enable several modes globally
#+BEGIN_SRC emacs-lisp
  (winner-mode t)
  (column-number-mode)
#+END_SRC

Donâ€™t bother confirming killing processes and donâ€™t let backup~ files scatter around
#+BEGIN_SRC emacs-lisp
  (use-package files
    :ensure nil
    :config
    (setq confirm-kill-processes nil
          make-backup-files nil))
#+END_SRC

Ediff configuration
#+BEGIN_SRC emacs-lisp
  (use-package ediff
    :ensure nil
    :config
    (setq ediff-split-window-function 'split-window-horizontally)
    (setq ediff-window-setup-function 'ediff-setup-windows-plain)
    (setq ediff-diff-options "-w"))
#+END_SRC

Change all prompts to y or n
#+BEGIN_SRC emacs-lisp
  (fset 'yes-or-no-p 'y-or-n-p)
#+END_SRC

Set global font and size
#+BEGIN_SRC emacs-lisp
  (add-to-list 'default-frame-alist '(font . "FiraCode Nerd Font"))
  (set-face-attribute 'default t :font "FiraCode Nerd Font")
  (set-face-attribute 'default nil :height 80)
#+END_SRC

Hydra
- https://github.com/abo-abo/hydra
#+BEGIN_SRC emacs-lisp
  (use-package hydra
    :demand t
    :init
    (global-set-key
     (kbd "C-x t")
     (defhydra toggle (:color blue)
       "toggle"
       ("a" abbrev-mode "abbrev")
       ("s" flyspell-mode "flyspell")
       ("d" toggle-debug-on-error "debug")
       ("c" fci-mode "fCi")
       ("f" auto-fill-mode "fill")
       ("t" toggle-truncate-lines "truncate")
       ("w" whitespace-mode "whitespace")
       ("q" nil "cancel")))
    (global-set-key
     (kbd "C-c t")
     (defhydra hydra-global-org (:color blue)
       "Org"
       ("t" org-timer-start "Start Timer")
       ("s" org-timer-stop "Stop Timer")
       ("r" org-timer-set-timer "Set Timer") ; This one requires you be in an orgmode doc, as it sets the timer for the header
       ("p" org-timer "Print Timer") ; output timer value to buffer
       ("w" (org-clock-in '(4)) "Clock-In") ; used with (org-clock-persistence-insinuate) (setq org-clock-persist t)
       ("o" org-clock-out "Clock-Out") ; you might also want (setq org-log-note-clock-out t)
       ("j" org-clock-goto "Clock Goto") ; global visit the clocked task
       ("c" org-capture "Capture") ; Don't forget to define the captures you want http://orgmode.org/manual/Capture.html
       ("l" (or )rg-capture-goto-last-stored "Last Capture")))
    (global-set-key
     (kbd "M-g M-g")
     (defhydra hydra-git-gutter (:body-pre (git-gutter-mode 1)
                                           :hint nil)
       "
    Git gutter:
    _j_: next hunk        _s_tage hunk     _q_uit
    _k_: previous hunk    _r_evert hunk    _Q_uit and deactivate git-gutter
    ^ ^                   _p_opup hunk
    _h_: first hunk
    _l_: last hunk        set start _R_evision
  "
       ("j" git-gutter:next-hunk)
       ("k" git-gutter:previous-hunk)
       ("h" (progn (goto-char (point-min))
                   (git-gutter:next-hunk 1)))
       ("l" (progn (goto-char (point-min))
                   (git-gutter:previous-hunk 1)))
       ("s" git-gutter:stage-hunk)
       ("r" git-gutter:revert-hunk)
       ("p" git-gutter:popup-hunk)
       ("R" git-gutter:set-start-revision)
       ("q" nil :color blue)
       ("Q" (progn (git-gutter-mode -1)
                   ;; git-gutter-fringe doesn't seem to
                   ;; clear the markup right away
                   (sit-for 0.1)
                   (git-gutter:clear))
        :color blue))
     ))
#+END_SRC


Projectile
- https://github.com/bbatsov/projectile
#+BEGIN_SRC emacs-lisp
  (use-package projectile
    :diminish projectile-mode
    :config (projectile-mode)
    :custom ((projectile-completion-system 'ivy))
    :bind-keymap
    ("C-c p" . projectile-command-map)
    :init
    ;; NOTE: Set this to the folder where you keep your Git repos!
    (when (file-directory-p "~/Projects")
      (setq projectile-project-search-path '("~/Projects")))
    (setq projectile-switch-project-action #'projectile-dired))

  (use-package counsel-projectile
    :config (counsel-projectile-mode))
#+END_SRC

Treemacs
- https://github.com/Alexander-Miller/treemacs
#+BEGIN_SRC emacs-lisp
  (use-package treemacs
    :demand t
    :defer t
    :init
    (with-eval-after-load 'winum
      (define-key winum-keymap (kbd "M-0") #'treemacs-select-window))
    :config
    (progn
      (setq treemacs-collapse-dirs                 (if treemacs-python-executable 3 0)
            treemacs-deferred-git-apply-delay      0.5
            treemacs-directory-name-transformer    #'identity
            treemacs-display-in-side-window        t
            treemacs-eldoc-display                 t
            treemacs-file-event-delay              5000
            treemacs-file-extension-regex          treemacs-last-period-regex-value
            treemacs-file-follow-delay             0.2
            treemacs-file-name-transformer         #'identity
            treemacs-follow-after-init             t
            treemacs-git-command-pipe              ""
            treemacs-goto-tag-strategy             'refetch-index
            treemacs-indentation                   2
            treemacs-indentation-string            " "
            treemacs-is-never-other-window         nil
            treemacs-max-git-entries               5000
            treemacs-missing-project-action        'ask
            treemacs-move-forward-on-expand        nil
            treemacs-no-png-images                 nil
            treemacs-no-delete-other-windows       t
            treemacs-project-follow-cleanup        nil
            treemacs-persist-file                  (expand-file-name ".cache/treemacs-persist" user-emacs-directory)
            treemacs-position                      'left
            treemacs-read-string-input             'from-child-frame
            treemacs-recenter-distance             0.1
            treemacs-recenter-after-file-follow    nil
            treemacs-recenter-after-tag-follow     nil
            treemacs-recenter-after-project-jump   'always
            treemacs-recenter-after-project-expand 'on-distance
            treemacs-show-cursor                   nil
            treemacs-show-hidden-files             t
            treemacs-hide-gitignored-files-mode    t
            treemacs-silent-filewatch              nil
            treemacs-silent-refresh                nil
            treemacs-sorting                       'alphabetic-asc
            treemacs-space-between-root-nodes      t
            treemacs-tag-follow-cleanup            t
            treemacs-tag-follow-delay              1.5
            treemacs-user-mode-line-format         nil
            treemacs-user-header-line-format       nil
            treemacs-width                         35
            treemacs-workspace-switch-cleanup      nil)
      (treemacs-follow-mode -1)
      (treemacs-filewatch-mode t))

    :bind
    (:map global-map
          ([f8]        . treemacs)
          ([f9]        . treemacs-projectile)
          ("M-0"       . treemacs-select-window)
          ("C-c 1"     . treemacs-delete-other-windows))
    )
  (use-package treemacs-projectile :demand t)
  (use-package treemacs-magit
    :after (treemacs magit)
    :demand t)
  (use-package lsp-treemacs :demand t :config (lsp-treemacs-sync-mode 1))
#+END_SRC

Dashboard
- https://github.com/emacs-dashboard/emacs-dashboard
#+BEGIN_SRC emacs-lisp
  (use-package dashboard
    :config
    (add-hook 'elpaca-after-init-hook #'dashboard-insert-startupify-lists)
    (add-hook 'elpaca-after-init-hook #'dashboard-initialize)
    :init
    (dashboard-setup-startup-hook)
    (setq initial-buffer-choice (lambda () (get-buffer-create dashboard-buffer-name))))


  ;; Content is not centered by default. To center, set
  (setq dashboard-center-content t)
  ;; vertically center content
  (setq dashboard-vertically-center-content t)

  (setq dashboard-items '((recents   . 5)
                          (bookmarks . 5)
                          (projects  . 5)
                          (agenda    . 5)))

  (setq dashboard-startupify-list '(dashboard-insert-banner
                                    dashboard-insert-newline
                                    dashboard-insert-banner-title
                                    dashboard-insert-newline
                                    dashboard-insert-navigator
                                    dashboard-insert-newline
                                    dashboard-insert-init-info
                                    dashboard-insert-items
                                    dashboard-insert-newline
                                    dashboard-insert-footer))

  (setq dashboard-icon-type 'all-the-icons)  ; use `all-the-icons' package
  (setq dashboard-set-heading-icons t)
  (setq dashboard-set-file-icons t)

  (setq dashboard-week-agenda t)
  (setq dashboard-filter-agenda-entry 'dashboard-no-filter-agenda)
#+END_SRC

Load fonts (emacs client doesn't load all the fonts in GUI mode)
#+BEGIN_SRC emacs-lisp
  (setq default-frame-alist '(
                              (font . "Iosevka")
                              (font . "Hack")
                              (font . "Fira Code")))
#+END_SRC
*** Windows Management
Ace-window
- https://github.com/abo-abo/ace-window
#+BEGIN_SRC emacs-lisp
  (use-package ace-window
    :ensure t)
  (global-set-key (kbd "M-o") 'ace-window)
  (setq aw-background nil)
  (defvar aw-dispatch-alist
    '((?x aw-delete-window "Delete Window")
      (?m aw-swap-window "Swap Windows")
      (?M aw-move-window "Move Window")
      (?c aw-copy-window "Copy Window")
      (?j aw-switch-buffer-in-window "Select Buffer")
      (?n aw-flip-window)
      (?u aw-switch-buffer-other-window "Switch Buffer Other Window")
      (?c aw-split-window-fair "Split Fair Window")
      (?v aw-split-window-vert "Split Vert Window")
      (?b aw-split-window-horz "Split Horz Window")
      (?o delete-other-windows "Delete Other Windows")
      (?? aw-show-dispatch-help))
    "List of actions for `aw-dispatch-default'.")
#+END_SRC

*** Git
Magit
- https://github.com/magit/magit
#+BEGIN_SRC emacs-lisp
  (use-package magit
    :ensure t
    :demand t
    :after transient
    :init
    (progn
      (bind-key "C-x g" 'magit-status))
    :commands (magit-status magit-get-current-branch)
    :custom (magit-display-buffer-function #'magit-display-buffer-same-window-except-diff-v1))
#+END_SRC

Forge
- https://github.com/magit/forge
#+BEGIN_SRC emacs-lisp
  (use-package transient :demand t)
  (use-package forge
    :demand t
    :after magit)
  (setq auth-sources '("~/.authinfo"))
#+END_SRC

git-gutter
- https://github.com/emacsorphanage/git-gutter
#+BEGIN_SRC emacs-lisp
  (use-package git-gutter
    :demand t
    :init
    (global-git-gutter-mode +1))
#+END_SRC

Time machine
- https://github.com/emacsmirror/git-timemachine
#+BEGIN_SRC emacs-lisp
  (use-package git-timemachine
    :demand t)
#+END_SRC

gitignore
- https://github.com/xuchunyang/gitignore-templates.el
#+BEGIN_SRC emacs-lisp
  (use-package gitignore-templates)
#+END_SRC

* Code edition
Hightlight current line
#+BEGIN_SRC emacs-lisp
  (global-hl-line-mode 1)
#+END_SRC

Replace Selection
#+BEGIN_SRC emacs-lisp
  (delete-selection-mode 1)
#+END_SRC

Invoke Hippie expand insead dabbrev
#+BEGIN_SRC emacs-lisp
  (global-set-key [remap dabbrev-expand] 'hippie-expand)
  (setq hippie-expand-try-functions-list
        '(try-complete-file-name-partially   ; complete filenames, start with /
          try-complete-file-name
          yas-hippie-try-expand              ; expand matching snippets
          try-expand-all-abbrevs
          try-expand-list                    ; help when args repeated another's args
          ;; try-expand-line
          try-expand-dabbrev
          try-expand-dabbrev-all-buffers
          try-expand-whole-kill              ; grab text from the kill ring
          try-expand-dabbrev-from-kill       ; as above
          try-complete-lisp-symbol-partially
          try-complete-lisp-symbol))
#+END_SRC

Show matching parentheses
#+BEGIN_SRC emacs-lisp
  (show-paren-mode 1)
#+END_SRC

Disable the electric indent mode
#+BEGIN_SRC emacs_list
  (electric-indent-mode -1)
#+END_SRC

Rainbow delimiters
- https://github.com/Fanael/rainbow-delimiters
#+BEGIN_SRC emacs-lisp
  (use-package rainbow-delimiters
    :config
    (setq rainbow-delimiters-max-face-count 9))
  (add-hook 'prog-mode-hook 'rainbow-delimiters-mode)
#+END_SRC

Replace keywords with symbols
#+BEGIN_SRC emacs-lisp
  (global-prettify-symbols-mode 1)
#+END_SRC

Font-lock annotations like TODO in source code
- https://github.com/tarsius/hl-todo
#+BEGIN_SRC emacs-lisp
  (setq hl-todo-keyword-faces
        '(("TODO"   . "#FF0000")
          ("FIXME"  . "#FF0000")
          ("DEBUG"  . "#A020F0")
          ("GOTCHA" . "#FF4500")
          ("STUB"   . "#1E90FF")))

  (use-package hl-todo :demand t)

  (eval-after-load 'hl-todo '(global-hl-todo-mode 1))
#+END_SRC

Display the current function name in the mode line
#+BEGIN_SRC emacs-lisp
  (which-function-mode 1)
#+END_SRC

Expand the marked region in semantic increments (negative prefix to reduce region)
- https://github.com/magnars/expand-region.el
  #+BEGIN_SRC emacs-lisp
    (use-package expand-region
      :demand t
      :config
      (global-set-key (kbd "C-=") 'er/expand-region))
  #+END_SRC

No tabs
#+BEGIN_SRC emacs-lisp
  (setq-default indent-tabs-mode nil)
#+END_SRC

Replace TAB with 4 spaces
#+BEGIN_SRC emacs-lisp
  (setq-default tab-width 4)
#+END_SRC

Display line numbers
#+BEGIN_SRC emacs-lisp
  (add-hook 'prog-mode-hook 'display-line-numbers-mode)
#+END_SRC

autocomplete parentheses
#+BEGIN_SRC emacs-lisp
  (electric-pair-mode t)
#+END_SRC

Remap c-z to undo
#+BEGIN_SRC emacs-lisp
  (global-set-key (kbd "C-z") 'undo)
#+END_SRC

Replace selection
#+BEGIN_SRC emacs-lisp
  (delete-selection-mode 1)
#+END_SRC

Cleanup whitespace on save
#+BEGIN_SRC emacs-lisp
  (use-package whitespace
    :ensure nil
    :hook (before-save . whitespace-cleanup))
#+END_SRC

Highlight indent guides
- https://github.com/DarthFennec/highlight-indent-guides
#+BEGIN_SRC emacs-lisp
  (use-package highlight-indent-guides
    :demand t
    :hook ((prog-mode text-mode conf-mode) . highlight-indent-guides-mode)
    :init
    (setq highlight-indent-guides-method 'column)
    :config
    (add-hook 'focus-in-hook #'highlight-indent-guides-auto-set-faces))
#+END_SRC

Avy
Used jumping to visible text using a char-based decision tree
- https://github.com/abo-abo/avy
#+BEGIN_SRC emacs-lisp
  (use-package avy
    :demand t
    :bind ("M-s" . avy-goto-char)) ;; changed from char as per jcs
#+END_SRC

Yasnippet
- https://github.com/joaotavora/yasnippet
#+BEGIN_SRC emacs-lisp
  (use-package yasnippet
    :demand t
    :init
    (yas-global-mode 1))
  (setq yas-snippet-dirs
        '("~/.emacs.d/snippets"))
#+END_SRC

* Development
** General
Eldoc + Eldoc-box
- https://github.com/casouri/eldoc-box
#+BEGIN_SRC emacs-lisp
  (use-package eldoc
    :custom
    (eldoc-idle-delay 0.5)
    :hook (eglot-managed-mode . eldoc-mode))

  (use-package eldoc-box
    :ensure t
    :config
    (setq eldoc-box-hover-render-function
          (lambda (contents)
            (with-temp-buffer
              (insert contents)
              (markdown-mode)
              (font-lock-ensure)
              (buffer-string)))))
(unload-feature 'eldoc t)
#+END_SRC

Eldoc-mouse
- https://github.com/huangfeiyu/eldoc-mouse
#+BEGIN_SRC emacs-lisp
  (use-package eldoc-mouse :ensure t
    :bind (:map eldoc-mouse-mode-map
                ("<f1> <f1>" . eldoc-mouse-pop-doc-at-cursor))
    :hook eldoc-mode)
#+END_SRC

Corfu
https://github.com/minad/corfu
#+BEGIN_SRC emacs-lisp
  (use-package corfu
    :after eglot
    :ensure t
    :custom
    (corfu-auto t)
    (corfu-cycle t)
    (corfu-quit-no-match t)
    ;; Make the popup appear quicker
    (corfu-popupinfo-delay '(0.5 . 0.5))
    ;; Always have the same width
    (corfu-min-width 80)
    (corfu-max-width corfu-min-width)
    (corfu-count 14)
    (corfu-scroll-margin 4)
    ;; Have Corfu wrap around when going up
    (corfu-cycle t)
    (corfu-preselect-first t)
    :bind (:map corfu-map
                ;; Match `corfu-quick-complete' keybinding to `avy-goto-line'
                ("s-j" . corfu-quick-complete))
    :init
    ;; Enable Corfu
    (global-corfu-mode t)
    ;; Enable Corfu history mode to act like `prescient'
    (corfu-history-mode t)
    ;; Allow Corfu to show help text next to suggested completion
    (corfu-popupinfo-mode t))
  (setq completion-category-overrides '((eglot (styles orderless))
                                        (eglot-capf (styles orderless))))
#+END_SRC

Kind icon
https://github.com/jdtsmith/kind-icon
#+BEGIN_SRC emacs-lisp
  (use-package kind-icon
    :ensure t
    :after corfu
    :custom
    (kind-icon-blend-background t)
    (kind-icon-use-icons t)
    (kind-icon-default-face 'corfu-default)
    (kind-icon-blend-background nil)
    (kind-icon-blend-frac 0.08)
    :config
    (add-to-list 'corfu-margin-formatters #'kind-icon-margin-formatter))
#+END_SRC

Cape
https://github.com/minad/cape

#+BEGIN_SRC emacs-lisp
  ;; Cape
  (use-package cape
    :ensure t
    :after corfu
    :bind ("C-c p" . cape-prefix-map)
    :init
    (add-hook 'completion-at-point-functions #'cape-dabbrev)
    (add-hook 'completion-at-point-functions #'cape-file)
    (add-hook 'completion-at-point-functions #'cape-elisp-block)
    (add-hook 'completion-at-point-functions #'yasnippet-capf)
    (add-hook 'completion-at-point-functions #'eglot-completion-at-point))

  (use-package completion-preview
    :ensure nil
    :bind (:map completion-preview-active-mode-map
                ("M-f" . #'completion-preview-insert-word)
                ("C-M-f" . #'completion-preview-insert-sexp))
    :custom
    (completion-preview-minimum-symbol-length 2)
    :init
    (global-completion-preview-mode))
#+END_SRC


Toml/Ansible/Docker/Yaml modes
#+BEGIN_SRC emacs-lisp
  (use-package toml-mode :demand t)
  (use-package yaml-mode
    :demand t
    :mode ("\\.yml\\'"
           "\\.yaml\\'"))
  (use-package ansible :demand t)
  (use-package dockerfile-mode :demand t)
#+END_SRC

Multiple Cursor
#+BEGIN_SRC emacs-lisp
  (use-package multiple-cursors
    :demand t)

  (global-set-key (kbd "C-S-c C-S-c") 'mc/edit-lines)
  (global-set-key (kbd "C->") 'mc/mark-next-like-this)
  (global-set-key (kbd "C-<") 'mc/mark-previous-like-this)
  (global-set-key (kbd "C-c C-<") 'mc/mark-all-like-this)
#+END_SRC

Repeat mode
- Allows repeating a command via `C-x z` (press z each time you want to repet the command)
#+BEGIN_SRC emacs-lisp
  (use-package repeat
    :ensure nil
    :config
    (repeat-mode)
    :custom
    (repeat-too-dangerous '(kill-this-buffer))
    (repeat-exit-timeout 5))
#+END_SRC

Direnv
#+BEGIN_SRC emacs-lisp
  (use-package direnv
    :demand t
    :config
    (direnv-mode))
#+END_SRC

** Languages
Kdl
#+BEGIN_SRC emacs-lisp
  (use-package kdl-mode
    :ensure t)
  (add-to-list 'auto-mode-alist '("\\.kdl\\'" . kdl-mode))
#+END_SRC

Eglot
#+BEGIN_SRC emacs-lisp
  (use-package jsonrpc :demand t) ;; required by eglot
  (use-package eglot
    :demand t
    :defer t
    :ensure nil
    :custom
    (eglot-sync-connect 1)
    (eglot-autoshutdown t)
    (eglot-ignored-server-capabilities '(:documentHighlightProvider))
    :config
    (add-to-list 'eglot-server-programs
                 '((python-mode python-ts-mode) . ("pyrefly" "lsp")))
    (add-to-list 'eglot-server-programs
                 '((sh-mode bash-ts-mode) . ("bash-language-server" "start")))
    (add-to-list 'eglot-server-programs '(lua-mode . ("lua-language-server" "--stdio")))

    :hook
    (python-ts-mode . eglot-ensure)
    (sh-mode . eglot-ensure)
    ;; (eglot-managed-mode-hook . eldoc-box-hover-mode)
    )


#+END_SRC

LSP
#+BEGIN_SRC emacs-lisp
  (use-package lsp-mode
    :ensure
    :commands lsp
    :custom
    (lsp-completion-provider :none)
    (lsp-rust-analyzer-cargo-watch-command "clippy")
    (lsp-eldoc-render-all t)
    (lsp-idle-delay 0.6)
    ;; enable / disable the hints as you prefer:
    (lsp-inlay-hint-enable t)
    ;; These are optional configurations. See https://emacs-lsp.github.io/lsp-mode/page/lsp-rust-analyzer/#lsp-rust-analyzer-display-chaining-hints for a full list
    (lsp-rust-analyzer-display-lifetime-elision-hints-enable "skip_trivial")
    (lsp-rust-analyzer-display-chaining-hints t)
    (lsp-rust-analyzer-display-closure-return-type-hints t)
    (lsp-rust-analyzer-display-parameter-hints nil)
    (lsp-rust-analyzer-display-reborrow-hints "never")
    :config
    (add-hook 'lsp-mode-hook 'lsp-ui-mode)
    (add-hook 'lsp-mode-hook #'corfu-lsp-setup))


  (defun corfu-lsp-setup ()
    (setq-local completion-styles '(orderless)
                completion-category-defaults nil))

  (use-package lsp-ui
    :ensure
    :commands lsp-ui-mode
    :custom
    (lsp-ui-peek-always-show t)
    (lsp-ui-sideline-show-hover t)
    (lsp-ui-doc-enable nil))
#+END_SRC

Bash
#+BEGIN_SRC emacs-lisp
  (add-to-list 'auto-mode-alist '("\\.sh\\'" . sh-mode))
  (setq sh-basic-offset 2 sh-indentation 2)
#+END_SRC

Lua
#+BEGIN_SRC emacs-lisp
  (use-package lua-mode)
  (add-to-list 'auto-mode-alist '("\\.lua\\'" . lua-mode))
#+END_SRC

Python
#+BEGIN_SRC emacs-lisp
  (setq major-mode-remap-alist
        '((python-mode . python-ts-mode)))

  (use-package pyvenv
    :init
    (setenv "WORKON_HOME" "~/.pyenv/versions"))

  (use-package flymake-ruff
    :hook (python-ts-mode . flymake-ruff-load))

  (use-package ruff-format
    :hook (python-ts-mode . ruff-format-on-save-mode))

  (add-hook 'eglot-managed-mode-hook 'flymake-ruff-load)

  ;; https://github.com/vale981/py-vterm-interaction.el
  (use-package py-vterm-interaction
    :hook (python-ts-mode . py-vterm-interaction-mode)
    :config
    (setq-default py-vterm-interaction-repl-program "ipython")
    (setq-default py-vterm-interaction-silent-cells t)
    )
   (add-hook 'python-ts-mode-hook #'py-vterm-interaction-mode)
#+END_SRC

Rust
#+BEGIN_SRC emacs-lisp
  (use-package rustic
    :ensure t
    :bind (:map rustic-mode-map
                ;; Eglot/Built-in equivalents
                ("M-j" . imenu)                   ; Standard Emacs imenu (replaces lsp-ui-imenu)
                ("M-." . xref-find-definitions)   ; Built-in (replaces lsp-find-definitions)
                ("M-?" . xref-find-references)    ; Built-in (replaces lsp-find-references)
                ("C-c C-c l" . flymake-show-buffer-diagnostics) ; Eglot uses Flymake, not Flycheck
                ("C-c C-c a" . eglot-code-actions)
                ("C-c C-c r" . eglot-rename)
                ("C-c C-c q" . eglot-reconnect)    ; Restarts the connection
                ("C-c C-c Q" . eglot-shutdown)     ; Shuts down the server
                )
    :custom-face
    ;; Faces are defined here instead of a separate custom-set-faces block
    (rustic-compilation-column ((t (:inherit compilation-column-number))))
    (rustic-compilation-line ((t (:foreground "LimeGreen"))))
    :config
    ;; uncomment for less flashiness
    ;; (setq lsp-eldoc-hook nil)
    ;; (setq lsp-enable-symbol-highlighting nil)
    ;; (setq lsp-signature-auto-activate nil)
    (setq rustic-lsp-client 'eglot)
    (setq rustic-format-on-save t)
    (add-hook 'rustic-mode-hook 'rk/rustic-mode-hook))

  (defun rk/rustic-mode-hook ()
    (when buffer-file-name
      (setq-local buffer-save-without-query t))
     (add-hook 'before-save-hook #'eglot-format-buffer nil t))
#+END_SRC

Flycheck
#+BEGIN_SRC emacs-lisp
  (use-package flycheck :ensure t)
#+END_SRC

Haskell
#+BEGIN_SRC emacs-lisp
  (use-package haskell-mode)
#+END_SRC

Common Lisp
#+BEGIN_SRC emacs-lisp
  (use-package sly :demand t)
#+END_SRC

Terraform
#+BEGIN_SRC emacs-lisp
  (use-package terraform-mode
    :custom (terraform-indent-level 4)
    :config
    (defun my-terraform-mode-init ()
      (terraform-format-on-save-mode 1)))

#+END_SRC

web mode
#+BEGIN_SRC emacs-lisp
  (use-package web-mode :demand t)
  (add-to-list 'auto-mode-alist '("\\.html\\'" . web-mode))
  (setq web-mode-markup-indent-offset 2)
  (setq web-mode-css-indent-offset 2)
  (setq web-mode-code-indent-offset 2)
#+END_SRC

emmet mode
#+BEGIN_SRC emacs-lisp
  (use-package emmet-mode :demand t)
  (add-hook 'sgml-mode-hook 'emmet-mode) ;; Auto-start on any markup modes
  (add-hook 'css-mode-hook  'emmet-mode) ;; enable Emmet's css abbreviation.
  (add-hook 'web-mode-hook  'emmet-mode) ;; enable Emmet's css abbreviation.
#+END_SRC

** Vertico / Orderless / Marginalia / Consult / Embark
+  https://github.com/minad/vertico
+ https://github.com/oantolin/orderless
+ https://github.com/minad/consult

*Vertico* minimalistic vertical completion UI
#+BEGIN_SRC emacs-lisp
  ;; Enable Vertico.
  (use-package vertico
    :custom
    (vertico-scroll-margin 0) ;; Different scroll margin
    (vertico-count 20) ;; Show more candidates
    (vertico-resize t) ;; Grow and shrink the Vertico minibuffer
    (vertico-cycle t) ;; Enable cycling for `vertico-next/previous'
    :init
    (vertico-indexed-mode 1)
    (vertico-multiform-mode 1)
    (vertico-mode 1)
    :config
    (setq vertico-multiform-commands
          '((consult-line buffer)
            (consult-line-thing-at-point buffer)
            (consult-recent-file buffer)
            (consult-mode-command buffer)
            (consult-complex-command buffer)
            (embark-bindings buffer)
            (consult-locate buffer)
            (consult-project-buffer buffer)
            (consult-ripgrep buffer)
            (consult-fd buffer)))
    :bind (:map vertico-map
                ("C-k" . kill-whole-line)
                ("C-u" . kill-whole-line)
                ("C-o" . vertico-next-group)
                ("<tab>" . minibuffer-complete)
                ("M-<return>" . minibuffer-force-complete-and-exit)))


  ;; Optionally use the `orderless' completion style.
  (use-package orderless
    :custom
    ;; Configure a custom style dispatcher (see the Consult wiki)
    ;; (orderless-style-dispatchers '(+orderless-consult-dispatch orderless-affix-dispatch))
    ;; (orderless-component-separator #'orderless-escapable-split-on-space)
    (completion-styles '(orderless basic))
    (completion-category-overrides '((file (styles partial-completion))))
    (completion-category-defaults nil) ;; Disable defaults, use our settings
    (completion-pcm-leading-wildcard t)) ;; Emacs 31: partial-completion behaves like substring

  ;; save search history
  (savehist-mode t)
  (setq savehist-file "~/.emacs.d/savehist")


  (setq read-file-name-completion-ignore-case t
        read-buffer-completion-ignore-case t
        completion-ignore-case t)

  ;; Prompt indicator for `completing-read-multiple'.
  (when (< emacs-major-version 31)
    (advice-add #'completing-read-multiple :filter-args
                (lambda (args)
                  (cons (format "[CRM%s] %s"
                                (string-replace "[ \t]*" "" crm-separator)
                                (car args))
                        (cdr args)))))

  ;; Configure directory extension.
  (use-package vertico-directory
    :after vertico
    :ensure nil
    ;; More convenient directory navigation commands
    :bind (:map vertico-map
                ("RET" . vertico-directory-enter)
                ("DEL" . vertico-directory-delete-char)
                ("M-DEL" . vertico-directory-delete-word))
    ;; Tidy shadowed file names
    :hook (rfn-eshadow-update-overlay . vertico-directory-tidy))
    #+END_SRC
*Marginalia*
#+BEGIN_SRC emacs-lisp
  ;; Enable rich annotations using the Marginalia package
  (use-package marginalia
    ;; Bind `marginalia-cycle' locally in the minibuffer.  To make the binding
    ;; available in the *Completions* buffer, add it to the
    ;; `completion-list-mode-map'.
    :bind (:map minibuffer-local-map
                ("M-A" . marginalia-cycle))

    ;; The :init section is always executed.
    :init

    ;; Marginalia must be activated in the :init section of use-package such that
    ;; the mode gets enabled right away. Note that this forces loading the
    ;; package.
    (marginalia-mode))
#+END_SRC

Consult
#+BEGIN_SRC emacs-lisp
  ;; Example configuration for Consult
  (use-package consult

    ;; ;; The :init configuration is always executed (Not lazy)
    :init

    ;; ;; Tweak the register preview fo
    ;; r `consult-register-load',
    ;; `consult-register-store' and the built-in commands.  This improves the
    ;; register formatting, adds thin separator lines, register sorting and hides
    ;; the window mode line.
    (advice-add #'register-preview :override #'consult-register-window)
    (setq register-preview-delay 0.5)

    ;; Use Consult to select xref locations with preview
    (setq xref-show-xrefs-function #'consult-xref
          xref-show-definitions-function #'consult-xref)

    ;; Configure other variables and modes in the :config section,
    ;; after lazily loading the package.
    :config

    ;; Optionally configure preview. The default value
    ;; is 'any, such that any key triggers the preview.
    ;; (setq consult-preview-key 'any)
    ;; (setq consult-preview-key "M-.")
    ;; (setq consult-preview-key '("S-<down>" "S-<up>"))
    ;; For some commands and buffer sources it is useful to configure the
    ;; :preview-key on a per-command basis using the `consult-customize' macro.
    (consult-customize
     consult-theme :preview-key '(:debounce 0.2 any)
     consult-ripgrep consult-git-grep consult-grep consult-man
     consult-bookmark consult-recent-file consult-xref
     consult-source-bookmark consult-source-file-register
     consult-source-recent-file consult-source-project-recent-file
     ;; :preview-key "M-."
     :preview-key '(:debounce 0.4 any))

    ;; Optionally configure the narrowing key.
    ;; Both < and C-+ work reasonably well.
    (setq consult-narrow-key "<") ;; "C-+"

    ;; Optionally make narrowing help available in the minibuffer.
    ;; You may want to use `embark-prefix-help-command' or which-key instead.
    ;; (keymap-set consult-narrow-map (concat consult-narrow-key " ?") #'consult-narrow-help)
    )
#+END_SRC

Embark
#+BEGIN_SRC emacs-lisp
  (use-package embark
    :ensure t

    :bind
    (("C-." . embark-act)         ;; pick some comfortable binding
     ("C-;" . embark-dwim)        ;; good alternative: M-.
     ("C-h B" . embark-bindings)) ;; alternative for `describe-bindings'

    :init

    ;; Optionally replace the key help with a completing-read interface
    (setq prefix-help-command #'embark-prefix-help-command)

    ;; Show the Embark target at point via Eldoc. You may adjust the
    ;; Eldoc strategy, if you want to see the documentation from
    ;; multiple providers. Beware that using this can be a little
    ;; jarring since the message shown in the minibuffer can be more
    ;; than one line, causing the modeline to move up and down:

    ;; (add-hook 'eldoc-documentation-functions #'embark-eldoc-first-target)
    ;; (setq eldoc-documentation-strategy #'eldoc-documentation-compose-eagerly)

    ;; Add Embark to the mouse context menu. Also enable `context-menu-mode'.
    ;; (context-menu-mode 1)
    ;; (add-hook 'context-menu-functions #'embark-context-menu 100)

    :config

    ;; Hide the mode line of the Embark live/completions buffers
    (add-to-list 'display-buffer-alist
                 '("\\`\\*Embark Collect \\(Live\\|Completions\\)\\*"
                   nil
                   (window-parameters (mode-line-format . none)))))

  ;; Consult users will also want the embark-consult package.
  (use-package embark-consult
    :ensure t ; only need to install it, embark loads it after consult if found
    :hook
    (embark-collect-mode . consult-preview-at-point-mode))
#+END_SRC


*** Searching
Silver search
- https://github.com/Wilfred/ag.el
#+BEGIN_SRC emacs-lisp
  (use-package ag :demand t)
  (setq ag-highlight-search t)
#+END_SRC

Anzu
displays current match and total matches information in the mode-line
 - https://github.com/emacsorphanage/anzu
#+BEGIN_SRC emacs-lisp
(use-package anzu :demand t :init(global-anzu-mode))
;; (global-anzu-mode +1)
(global-set-key [remap query-replace] 'anzu-query-replace)
(global-set-key [remap query-replace-regexp] 'anzu-query-replace-regexp)

(defun my/anzu-update-func (here total)
  (when anzu--state
    (let ((status (cl-case anzu--state
                    (search (format "<%d/%d>" here total))
                    (replace-query (format "(%d Replaces)" total))
                    (replace (format "<%d/%d>" here total)))))
      (propertize status 'face 'anzu-mode-line))))

(custom-set-variables
 '(anzu-mode-lighter "")
 '(anzu-deactivate-region t)
 '(anzu-search-threshold 1000)
 '(anzu-replace-threshold 50)
 '(anzu-replace-to-string-separator " => ")
 '(anzu-mode-line-update-function #'my/anzu-update-func))
(global-set-key [remap query-replace] 'anzu-query-replace)
(global-set-key [remap query-replace-regexp] 'anzu-query-replace-regexp)
#+END_SRC

* Keybindings
Keychord
- https://github.com/emacsorphanage/key-chord/tree/7f7fd7c5bd2b996fa054779357e1566f7989e07d
#+BEGIN_SRC emacs-lisp
  (use-package key-chord
    :demand t
    :config
    (key-chord-mode 1)
    (key-chord-define-global "kk" 'forward-word)
    (key-chord-define-global "xx" 'save-buffer)
    (key-chord-define-global "jj" 'backward-word)
    (key-chord-define-global "Ã±Ã±" 'kill-whole-line)
    (key-chord-define-global "yy" 'copy-line)
    (key-chord-define-global "yp" 'duplicate-line)
    (key-chord-define-global "qq" 'delete-other-windows))
#+END_SRC

Editing
#+BEGIN_SRC emacs-lisp
(defun duplicate-line()
  "functions being used in a keybinding"
  (interactive)
  (move-beginning-of-line 1)
  (kill-line)
  (yank)
  (open-line 1)
  (next-line 1)
  (yank))

(defun copy-line (arg)
  "Copy lines (as many as prefix argument) in the kill ring"
  (interactive "p")
  (kill-ring-save (line-beginning-position)
                  (line-beginning-position (+ 1 arg)))
  (message "%d line%s copied" arg (if (= 1 arg) "" "s")))
(defun get-point (symbol &optional arg)
  "get the point"
  (funcall symbol arg)
  (point))

(defun copy-thing (begin-of-thing end-of-thing &optional arg)
  "copy thing between beg & end into kill ring"
  (save-excursion
    (let ((beg (get-point begin-of-thing 1))
          (end (get-point end-of-thing arg)))
      (copy-region-as-kill beg end))))

(defun copy-word (&optional arg)
  "Copy words at point into kill-ring"
  (interactive "P")
  (copy-thing 'backward-word 'forward-word arg)
  (paste-to-mark arg))
#+END_SRC

#+BEGIN_SRC emacs-lisp
(global-set-key (kbd "M-p") 'org-edit-src-code)
#+END_SRC

Ibuffer
#+BEGIN_SRC emacs-lisp
(global-set-key (kbd "C-x C-b") 'ibuffer)
(setq ibuffer-saved-filter-groups
      (quote (("default"
               ("dired" (mode . dired-mode))
               ("org" (name . "^.*org$"))
               ("web" (or (mode . web-mode) (mode . js2-mode)))
               ("shell" (or (mode . eshell-mode) (mode . shell-mode)))
               ("python" (mode . python-mode))
               ("terraform" (mode . terraform-mode))
               ("rust" (name . "^.*rs$"))
               ("emacs" (or
                         (name . "^\\*scratch\\*$")
                         (name . "^\\*Messages\\*$")))
               ))))
(add-hook 'ibuffer-hook
          (lambda ()
            (ibuffer-auto-mode 1)
            (ibuffer-switch-to-saved-filter-groups "default")))

;; Don't show filter groups if there are no buffers in that group
(setq ibuffer-show-empty-filter-groups nil)
;; Don't ask for confirmation to delete marked buffers
(setq ibuffer-expert t)

;; Modify the default ibuffer-formats
(setq ibuffer-formats
      '((mark modified read-only " "
              (name 18 18 :left :elide)
              " "
              (size 9 -1 :right)
              " "
              (mode 16 16 :left :elide)
              " "
              filename-and-process)))
#+END_SRC

* Org Mode
Olivetti
#+BEGIN_SRC emacs-lisp
  (use-package olivetti
    :init
    (setq olivetti-body-width 200)
    (setq olivetti-style 'fancy)
    (setq olivetti-minimum-body-width 140))
#+END_SRC

Org mode
#+BEGIN_SRC emacs-lisp
  ;; https://github.com/minad/org-modern
  (use-package org-modern
    :after org
    :config (global-org-modern-mode)
    :custom
    (org-modern-priority t)
    :init
    (setq org-modern-hide-stars 'leading
          org-modern-priority
          (quote ((?A . " ï€¤")
                  (?B . " ï„ž")
                  (?C . " ó°ˆ¿")))
          org-modern-keyword
          (quote (("options" . "ðŸ”§")
                  ("tag" . "")
                  ("#+" . "âž¤")
                  (t . t)))))
  (elpaca (org-modern-indent :host github :repo "jdtsmith/org-modern-indent")
    :config ; add late to hook
    (add-hook 'org-mode-hook #'org-modern-indent-mode 90))

  ;; org-download: https://github.com/abo-abo/org-download
  (use-package org-download
    :hook
    (org-mode . org-download-enable))
  (setq-default org-download-image-dir "./images")

  (use-package org
    :ensure nil
    :demand t
    :init
    ;; edit settings (recommended by org-modern)
    (setq org-auto-align-tags nil
            org-tags-column 0
            org-catch-invisible-edits 'show-and-error
            org-special-ctrl-a/e t ;; special navigation behaviour in headlines
            org-insert-heading-respect-content t)
    ;; styling, hide markup, etc. (recommended by org-modern)
    (setq org-hide-emphasis-markers t
          org-src-fontify-natively t ;; fontify source blocks natively
          org-highlight-latex-and-related '(native) ;; fontify latex blocks natively
          org-pretty-entities t)

    ;; agenda styling (recommended by org-modern)
    (setq org-agenda-tags-column 0
          org-agenda-block-separator ?â”€
          org-agenda-time-grid
          '((daily today require-timed)
            (800 1000 1200 1400 1600 1800 2000)
            " â”„â”„â”„â”„â”„ " "â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„")
          org-agenda-current-time-string
          "â­  now â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€")
    (setq org-ellipsis "...")
    (setq org-todo-keywords
          ;; it's extremely useful to distinguish between short-term goals and long-term projects
          '((sequence "TODO(t)" "SOMEDAY(s)" "|" "DONE(d)")
            (sequence "TO-READ(r)" "READING(R)" "|" "HAVE-READ(d)")
            (sequence "PROJ(p)" "|" "COMPLETED(c)")))
    :hook
    (org-mode . olivetti-mode)
    (org-mode . (lambda () (electric-indent-local-mode -1)))
  )
#+END_SRC

Org Agenda
#+BEGIN_SRC emacs-lisp
  (custom-set-variables
   '(org-directory "~/Documents/org")
   '(org-agenda-files (list org-directory)))

  (define-key org-mode-map (kbd "C-c a m") 'org-agenda)
#+END_SRC

Org-mime
-https://github.com/org-mime/org-mime
#+BEGIN_SRC emacs-lisp
  (use-package org-mime)
  (add-hook 'message-mode-hook
            (lambda ()
              (local-set-key (kbd "C-c M-o") 'org-mime-htmlize)))
  (add-hook 'org-mode-hook
            (lambda ()
              (local-set-key (kbd "C-c M-o") 'org-mime-org-buffer-htmlize)))
#+END_SRC

Ob-mermaid
- https://github.com/arnm/ob-mermaid
- Requires mermaid-cli: https://github.com/mermaid-js/mermaid-cli
#+BEGIN_SRC emacs-lisp
  (use-package ob-mermaid
    :after org
    :config
    ;; Add mermaid to org-babel languages once ob-mermaid is available
    (with-eval-after-load 'org
      (org-babel-do-load-languages
       'org-babel-load-languages
       '((mermaid . t)))))

  (if (memq window-system '(mac ns x))
      (setq ob-mermaid-cli-path "/opt/homebrew/bin/mmdc")
    (setq ob-mermaid-cli-path "/path/to//bin/mmdc"))
#+END_SRC

Org-babel
#+BEGIN_SRC emacs-lisp
  (org-babel-do-load-languages
   'org-babel-load-languages
   '((python . t)
     (scheme . t)
     (shell . t)
     (sqlite . t)))
#+END_SRC
